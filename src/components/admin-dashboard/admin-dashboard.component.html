@if (isLoading()) {
  <div class="flex animate-pulse">
    <!-- Sidebar Skeleton -->
    <div class="w-64 bg-slate-800 p-4 space-y-4">
      <div class="h-8 bg-slate-700 rounded w-3/4"></div>
      <div class="space-y-2">
        <div class="h-10 bg-slate-700 rounded"></div>
        <div class="h-10 bg-slate-700 rounded"></div>
        <div class="h-10 bg-slate-700 rounded"></div>
        <div class="h-10 bg-slate-700 rounded"></div>
        <div class="h-10 bg-slate-700 rounded"></div>
      </div>
    </div>
    <!-- Content Skeleton -->
    <div class="flex-1 p-8 space-y-8 bg-slate-100">
      <div class="h-12 bg-slate-200 rounded w-1/3"></div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="p-6 bg-slate-200 rounded-lg h-28"></div>
        <div class="p-6 bg-slate-200 rounded-lg h-28"></div>
        <div class="p-6 bg-slate-200 rounded-lg h-28"></div>
      </div>
      <div class="bg-slate-200 rounded-lg p-4 space-y-3 h-64"></div>
    </div>
  </div>
} @else {
  <div class="flex flex-col md:flex-row bg-slate-100 min-h-[calc(100vh-160px)]">
    <!-- Sidebar -->
    <aside class="w-full md:w-64 bg-slate-900 text-slate-200 flex-shrink-0">
      <div class="p-4 border-b border-slate-700">
        <h2 class="text-xl font-bold text-white">پنل مدیریت</h2>
      </div>
      <nav class="mt-4 px-2 space-y-1">
        <button (click)="activeView.set('overview')" [class]="activeView() === 'overview' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
          <i data-lucide="pie-chart" class="w-5 h-5 me-3"></i>
          <span>نمای کلی</span>
        </button>
        
        <!-- Accordion Menu for Roadmap -->
        <div>
           <button (click)="isRoadmapMenuOpen.set(!isRoadmapMenuOpen())" [class]="activeView() === 'roadmap' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center justify-between p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
              <span class="flex items-center">
                <i data-lucide="map-signs" class="w-5 h-5 me-3"></i>
                <span>نقشه راه پژوهش</span>
              </span>
              <i data-lucide="chevron-down" class="w-4 h-4 transition-transform" [class.rotate-180]="isRoadmapMenuOpen()"></i>
            </button>
            @if(isRoadmapMenuOpen()) {
              <div class="ms-4 mt-1 ps-4 border-s-2 border-slate-600 space-y-1">
                <button (click)="setRoadmapView('preliminary')" [class]="activeRoadmapView() === 'preliminary' ? 'text-white' : 'text-slate-400'" class="w-full text-right block p-2 rounded-lg hover:bg-slate-700 hover:text-white text-sm">مقدماتی</button>
                <button (click)="setRoadmapView('ready')" [class]="activeRoadmapView() === 'ready' ? 'text-white' : 'text-slate-400'" class="w-full text-right block p-2 rounded-lg hover:bg-slate-700 hover:text-white text-sm">آماده ارتقا</button>
                <button (click)="setRoadmapView('nlp')" [class]="activeRoadmapView() === 'nlp' ? 'text-white' : 'text-slate-400'" class="w-full text-right block p-2 rounded-lg hover:bg-slate-700 hover:text-white text-sm">گروه NLP</button>
                <button (click)="setRoadmapView('autonomous')" [class]="activeRoadmapView() === 'autonomous' ? 'text-white' : 'text-slate-400'" class="w-full text-right block p-2 rounded-lg hover:bg-slate-700 hover:text-white text-sm">گروه Autonomous</button>
                <button (click)="setRoadmapView('completed')" [class]="activeRoadmapView() === 'completed' ? 'text-white' : 'text-slate-400'" class="w-full text-right block p-2 rounded-lg hover:bg-slate-700 hover:text-white text-sm">تکمیل شده</button>
              </div>
            }
        </div>

        <button (click)="activeView.set('teachers')" [class]="activeView() === 'teachers' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
          <i data-lucide="user-check" class="w-5 h-5 me-3"></i>
          <span>مدیریت اساتید</span>
        </button>
        <button (click)="activeView.set('students')" [class]="activeView() === 'students' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
          <i data-lucide="users" class="w-5 h-5 me-3"></i>
          <span>مدیریت زبان‌آموزان</span>
        </button>
        <button (click)="activeView.set('institutes')" [class]="activeView() === 'institutes' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
          <i data-lucide="building-2" class="w-5 h-5 me-3"></i>
          <span>مدیریت موسسات</span>
        </button>
        <button (click)="activeView.set('exams')" [class]="activeView() === 'exams' ? 'bg-slate-700 text-white' : 'text-slate-300'" class="w-full text-right flex items-center p-3 rounded-lg hover:bg-slate-700 hover:text-white transition-colors duration-200">
          <i data-lucide="clipboard-list" class="w-5 h-5 me-3"></i>
          <span>مدیریت آزمون‌ها</span>
        </button>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-4 md:p-8 overflow-y-auto">
      @switch (activeView()) {
        @case ('overview') {
          <app-overview></app-overview>
        }
        @case ('roadmap') {
          <app-roadmap [activeRoadmapView]="activeRoadmapView()"></app-roadmap>
        }
        @case ('teachers') {
          <app-manage-teachers></app-manage-teachers>
        }
        @case ('students') {
          <app-manage-students></app-manage-students>
        }
        @case ('institutes') {
          <app-manage-institutes></app-manage-institutes>
        }
        @case ('exams') {
          <app-manage-exams></app-manage-exams>
        }
      }
    </main>
  </div>
}
