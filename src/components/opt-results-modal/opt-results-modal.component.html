@if(exam(); as exam) {
  <div class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-lg shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col">
      <div class="p-4 border-b flex justify-between items-center bg-slate-50 rounded-t-lg">
        <h3 class="text-xl font-bold text-slate-800">جزئیات آزمون OPT: {{ student().name }}</h3>
        <button (click)="closeModal()" class="text-slate-400 hover:text-slate-600">
          <i data-lucide="x" class="w-6 h-6"></i>
        </button>
      </div>
      <div class="p-6 md:p-8 overflow-y-auto">
        @if(exam.questions) {
          <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-5">
            @for(question of exam.questions; track question.id; let i = $index) {
              @let studentAnswer = student().optAnswers?.[question.id];
              @let isCorrect = studentAnswer === question.correctAnswer;
              <div class="p-4 rounded-lg border" [class.bg-green-50]="isCorrect" [class.border-green-300]="isCorrect" [class.bg-red-50]="!isCorrect && studentAnswer" [class.border-red-300]="!isCorrect && studentAnswer" [class.bg-slate-50]="!studentAnswer" [class.border-slate-200]="!studentAnswer">
                <p class="font-semibold text-slate-800 text-sm">سوال {{ i + 1 }}: {{ question.text }}</p>
                <div class="mt-3 text-xs space-y-2">
                  <p>
                    <span class="font-bold">پاسخ شما: </span>
                    <span [class.text-slate-500]="!studentAnswer" [class.font-mono]="studentAnswer">{{ studentAnswer ?? 'پاسخ داده نشده' }}</span>
                  </p>
                  <p>
                    <span class="font-bold">پاسخ صحیح: </span>
                    <span class="font-mono">{{ question.correctAnswer }}</span>
                  </p>
                </div>
                <div class="mt-2 text-right">
                    @if(studentAnswer) {
                      @if(isCorrect) {
                          <span class="inline-flex items-center text-green-700 font-bold text-xs">
                              <i data-lucide="check-circle-2" class="w-4 h-4 me-1"></i> درست
                          </span>
                      } @else {
                          <span class="inline-flex items-center text-red-700 font-bold text-xs">
                             <i data-lucide="x-circle" class="w-4 h-4 me-1"></i> نادرست
                          </span>
                      }
                    }
                </div>
              </div>
            }
          </div>
        } @else {
          <p class="text-center text-slate-500">سوالات این آزمون یافت نشد.</p>
        }
      </div>
      <div class="p-4 border-t flex justify-end bg-slate-50 rounded-b-lg">
         <button (click)="closeModal()" class="px-6 py-2 font-semibold text-slate-700 bg-white border border-slate-300 hover:bg-slate-100 rounded-lg">بستن</button>
      </div>
    </div>
  </div>
}
